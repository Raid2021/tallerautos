<!doctype html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8"><title>Vehículo</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container py-4">

<h3 th:text="${vehiculo.id} == null ? 'Nuevo vehículo' : 'Editar vehículo'"></h3>

<!-- IMPORTANTE: post a /vehiculos/guardar y objeto vehiculo -->
<form th:action="@{/vehiculos/guardar}" method="post" th:object="${vehiculo}" class="vstack gap-3">

  <!-- CSRF si está habilitado -->
  <input type="hidden" th:if="${_csrf != null}"
         th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

  <!-- Para edición -->
  <input type="hidden" th:field="*{id}"/>

  <div>
    <label class="form-label">Marca</label>
    <input class="form-control" th:field="*{marca}" required>
  </div>

  <div>
    <label class="form-label">Modelo</label>
    <input class="form-control" th:field="*{modelo}" required>
  </div>

  <div>
    <label class="form-label">Año</label>
    <input class="form-control" th:field="*{anno}" type="number" min="1900" max="2100" required>
  </div>

  <div>
    <label class="form-label">Placa</label>
    <input class="form-control" th:field="*{placa}" required>
  </div>

  <!-- Cliente: si vino clienteId, mándalo oculto; si no, selector -->
  <th:block th:if="${clienteId != null}">
    <input type="hidden" name="clienteId" th:value="${clienteId}">
    <div class="form-text">
      Cliente seleccionado:
      <strong th:text="${cliente?.nombreCompleto}">Cliente</strong>
    </div>
  </th:block>

  <th:block th:if="${clienteId == null}">
    <label class="form-label">Cliente</label>
    <select class="form-select" name="clienteId" required>
      <option value="" hidden th:if="${vehiculo.cliente == null}">Seleccione…</option>
      <option th:each="c : ${clientes}"
              th:value="${c.id}"
              th:selected="${vehiculo.cliente != null} ? (${c.id} == ${vehiculo.cliente.id}) : false"
              th:text="${c.nombreCompleto + ' (' + c.cedula + ')'}">
      </option>
    </select>
  </th:block>

  <div class="d-flex gap-2">
    <button class="btn btn-primary">Guardar</button>
    <a class="btn btn-secondary" th:href="@{/vehiculos/lista}">Cancelar</a>
  </div>
</form>

<!-- Mensajes simples si vuelves al form con error -->
<div class="alert alert-danger mt-3" th:if="${error}" th:text="${error}"></div>

</body>
</html>
